Heavily influenced by Tim Ross' implementation at http://l.tath.am/tFPwee
